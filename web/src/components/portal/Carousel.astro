---
import { resolveMediaUrl, getServiceImageUrl } from "../../utils/strapi";

interface Props {
  images: any[];
}

const { images } = Astro.props;
---

{images.length > 0 && (
  <section style="width: 100%; margin: 0 auto; position: relative;">
    <div
      id="carousel"
      style="
        width: 100%;
        max-width: 1200px;
        margin: 0 auto;
        position: relative;
        overflow: hidden;
        border-radius: 12px;
      "
    >
      <div
        id="carousel-track"
        style="
          display: flex;
          transition: transform 0.5s ease;
          width: 100%;
        "
      >
        {images.map((img, index) => {
          const imgUrl = resolveMediaUrl(img);
          return imgUrl ? (
            <div
              key={index}
              class="carousel-slide"
              style="
                min-width: 100%;
                flex-shrink: 0;
              "
            >
              <img
                src={imgUrl}
                alt={`Carrusel ${index + 1}`}
                style="
                  width: 100%;
                  height: 400px;
                  object-fit: cover;
                  display: block;
                "
                loading={index === 0 ? "eager" : "lazy"}
              />
            </div>
          ) : null;
        })}
      </div>
      
      {images.length > 1 && (
        <>
          <button
            id="carousel-prev"
            style="
              position: absolute;
              left: 16px;
              top: 50%;
              transform: translateY(-50%);
              background: rgba(0, 0, 0, 0.5);
              color: white;
              border: none;
              padding: 12px 16px;
              border-radius: 50%;
              cursor: pointer;
              font-size: 20px;
              z-index: 10;
              transition: background 0.2s ease;
            "
            onmouseover="this.style.background='rgba(0, 0, 0, 0.8)'"
            onmouseout="this.style.background='rgba(0, 0, 0, 0.5)'"
          >
            ‹
          </button>
          <button
            id="carousel-next"
            style="
              position: absolute;
              right: 16px;
              top: 50%;
              transform: translateY(-50%);
              background: rgba(0, 0, 0, 0.5);
              color: white;
              border: none;
              padding: 12px 16px;
              border-radius: 50%;
              cursor: pointer;
              font-size: 20px;
              z-index: 10;
              transition: background 0.2s ease;
            "
            onmouseover="this.style.background='rgba(0, 0, 0, 0.8)'"
            onmouseout="this.style.background='rgba(0, 0, 0, 0.5)'"
          >
            ›
          </button>
          
          <div
            id="carousel-dots"
            style="
              position: absolute;
              bottom: 16px;
              left: 50%;
              transform: translateX(-50%);
              display: flex;
              gap: 8px;
              z-index: 10;
            "
          >
            {images.map((_, index) => (
              <button
                class="carousel-dot"
                data-slide={index}
                style="
                  width: 12px;
                  height: 12px;
                  border-radius: 50%;
                  border: 2px solid white;
                  background: ${index === 0 ? "white" : "transparent"};
                  cursor: pointer;
                  padding: 0;
                  transition: background 0.2s ease;
                "
              >
              </button>
            ))}
          </div>
        </>
      )}
    </div>

    <script is:inline>
      (function() {
        const carousel = document.getElementById('carousel');
        if (!carousel) return;
        
        const track = document.getElementById('carousel-track');
        const prevBtn = document.getElementById('carousel-prev');
        const nextBtn = document.getElementById('carousel-next');
        const dots = document.querySelectorAll('.carousel-dot');
        const slides = document.querySelectorAll('.carousel-slide');
        
        if (!track || slides.length <= 1) return;
        
        let currentIndex = 0;
        
        function updateCarousel() {
          track.style.transform = `translateX(-${currentIndex * 100}%)`;
          dots.forEach((dot, index) => {
            dot.style.background = index === currentIndex ? 'white' : 'transparent';
          });
        }
        
        function nextSlide() {
          currentIndex = (currentIndex + 1) % slides.length;
          updateCarousel();
        }
        
        function prevSlide() {
          currentIndex = (currentIndex - 1 + slides.length) % slides.length;
          updateCarousel();
        }
        
        if (nextBtn) nextBtn.addEventListener('click', nextSlide);
        if (prevBtn) prevBtn.addEventListener('click', prevSlide);
        
        dots.forEach((dot, index) => {
          dot.addEventListener('click', () => {
            currentIndex = index;
            updateCarousel();
          });
        });
        
        // Auto-play cada 5 segundos
        setInterval(nextSlide, 5000);
      })();
    </script>
  </section>
)}
