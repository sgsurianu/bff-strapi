---
const STRAPI_URL = import.meta.env.PUBLIC_STRAPI_URL ?? "http://localhost:1337";

function resolveMediaUrl(media) {
  if (!media) return null;

  // Soporta distintas formas del objeto media (seg√∫n Strapi/config)
  const url =
    media?.url ??
    media?.data?.attributes?.url ??
    media?.data?.url ??
    null;

  if (!url) return null;
  if (url.startsWith("http")) return url;
  return `${STRAPI_URL}${url}`;
}

const res = await fetch(`${STRAPI_URL}/api/home?populate=*`);
if (!res.ok) throw new Error(`Strapi error: ${res.status}`);

const json = await res.json();
const home = json?.data ?? null;

// Compatible con variantes de estructura
const heroTitle = home?.heroTitle ?? home?.attributes?.heroTitle ?? "";
const heroSubtitle = home?.heroSubtitle ?? home?.attributes?.heroSubtitle ?? "";
const heroImage = home?.heroImage ?? home?.attributes?.heroImage ?? null;

const heroImageUrl = resolveMediaUrl(heroImage);
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Demo Strapi + Astro</title>
  </head>

  <body style="font-family: system-ui; padding: 32px; max-width: 900px; margin: 0 auto;">
    <h1>{heroTitle}</h1>
    <p>{heroSubtitle}</p>

    {heroImageUrl && (
      <img
        src={heroImageUrl}
        alt="Hero"
        style="max-width: 100%; border-radius: 12px; margin-top: 16px;"
      />
    )}
  </body>
</html>
